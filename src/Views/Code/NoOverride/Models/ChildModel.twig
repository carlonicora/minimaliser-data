<?php
namespace {{ data.attributes.namespace }}Models\{{ data.meta.parent.tablePluralCapitalised }};

use CarloNicora\Minimalism\Enums\HttpCode;
use CarloNicora\Minimalism\Enums\HttpCache;
use CarloNicora\JsonApi\Objects\Link;
use CarloNicora\JsonApi\Objects\ResourceObject;
use CarloNicora\Minimalism\Interfaces\Encrypter\Parameters\PositionedEncryptedParameter;
use {{ data.attributes.namespace }}AutoGenerated\Abstracts\Abstract{{ data.attributes.project }}Model;
use {{ data.attributes.namespace }}Data\{{ data.attributes.objectNamePlural }}\{{ data.attributes.objectName }}IO;
use {{ data.attributes.namespace }}Data\{{ data.attributes.objectNamePlural }}\{{ data.attributes.objectName }}Builder;
use Exception;

class {{ data.attributes.objectNamePlural }} extends Abstract{{ data.attributes.project }}Model
{
    /** @var HttpCache  */
    protected HttpCache $httpCache = HttpCache::Cache;

    /** @var int  */
    protected int $httpCacheExpiration = 60*60*24;

    /**
     * @param PositionedEncryptedParameter ${{ data.meta.parent.field }}
     * @param array|null $page
     * @return HttpCode
     * @throws Exception
     */
    public function get(
        PositionedEncryptedParameter ${{ data.meta.parent.field }},
        ?array $page=null,
    ): HttpCode
    {
        $this->updatePaginationIds($page);

        ${{ data.attributes.tableName }} = $this->objectFactory->create({{ data.attributes.objectName }}IO::class)->readBy{{ data.meta.parent.fieldCapitalised }}(
            {{ data.meta.parent.field }}: ${{ data.meta.parent.field }}->getValue(),
            page: $page,
        );

        $this->document->addResourceList(
            $this->builder->buildResources(
                builderClass: {{ data.attributes.objectName }}Builder::class,
                data: ${{ data.attributes.tableName }},
            )
        );

        $this->addPagination($page);

        return HttpCode::Ok;
    }
}